# DEVELOPER.md

Welcome! This is the developer guide for is-kit. It keeps things practical and aligned with how the repo works today. Have fun building! âœ¨

## Quick Start

- Requirements: Node 22, pnpm 10.12.4
- Recommended: use mise to pin tools and run tasks

```sh
# Setup toolchain + install deps
mise install                 # installs Node 22 and pnpm 10.12.4
pnpm install

# Build library and run tests
pnpm build                   # bundle to dist/ via tsup (ESM+CJS+types)
pnpm test                    # Jest runtime tests
pnpm test:types              # tsd type tests

# Work on docs (Next.js)
pnpm -C docs dev             # run docs site locally (http://localhost:3000)
```

Using mise tasks:

- Build: `mise run build`
- Test: `mise run test`
- Type tests: `mise run test-types`
- CI all: `mise run ci` (lint + build + test + type tests)

## Project Map

- src/ TypeScript sources (ESM, strict)
  - core/
    - guards: `primitive.ts`, `object.ts`
    - logic: `logic.ts` (`and`, `andAll`, `or`, `not`, `guardIn`)
    - equality: `equals.ts` (`equals`, `equalsBy`, `equalsKey`)
    - parsing: `parse.ts` (`safeParse`, `safeParseWith`)
    - nullability: `nullish.ts` (`nullable`, `nonNull`, `nullish`, `optional`, `required`)
    - helpers: `define.ts`, `predicate.ts`
    - combinators: `core/combinators/*` (`arrayOf`, `tupleOf`, `oneOf`, `recordOf`, `struct`, `oneOfValues`)
  - types/ Shared type utilities
  - utils/ Internal helpers (e.g., `toBooleanPredicates`)
  - index.ts Library entry re-exporting public API
- tests/ Jest runtime tests (mirror src/ paths)
- tests-d/ tsd type tests (mirror src/ paths)
- dist/ Build output generated by `tsup` (ESM .mjs, CJS .js, and .d.ts)
- docs/ Next.js docs site (shadcn), imports workspace `is-kit`
- Config: `tsconfig*.json`, `tests/tsconfig.json`, `tests-d/tsconfig.json`, `tsup.config.ts`, `jest.config.cjs`, `eslint.config.mjs`, `mise.toml`

Alias: `@/*` â†’ `src/` (see root tsconfig and jest `moduleNameMapper`).

## Everyday Commands

- `pnpm lint` run ESLint over the repo (flat config)
- `pnpm build` bundle via tsup (cleans dist/, builds ESM+CJS+types)
- `pnpm test` run Jest specs under `tests/`
- `pnpm test:types` run tsd specs under `tests-d/`
- `pnpm typedoc` generate API docs to `docs/public/api`

Docs app:

- `pnpm -C docs dev` start Next.js dev server
- `pnpm -C docs build && pnpm -C docs start` production build/serve
- `pnpm -C docs lint` lint docs project

## Coding Style

- TypeScript `strict: true`; ESM-first; target ES2022 (bundled for ESM/CJS)
- Imports: prefer `@/*` alias for internal modules
- Formatting: Prettier; 2-space indent; single quotes; semicolons
- ESLint: flat config (extends `@eslint/js` recommended)
  - Repo rules: `complexity` â‰¤ 7; `no-unused-vars`/`no-undef` warn
  - Lint ignores: `dist/*`, and built docs output
- File naming: kebab-case for modules; named exports
- Public API: re-export from `src/index.ts`
- Comments: JSDoc on public exports; short WHY comments for non-obvious logic
- Do not edit `dist/` manually

See AGENTS.md for additional conventions used by this repo.

## Tests

- Runtime: Jest (`jest.config.cjs` with `ts-jest`), roots under `tests/`
- Types: tsd under `tests-d/` (uses dedicated `tests-d/tsconfig.json`)
- Alias mapping: `@/(.+)` â†’ `src/$1` is configured for Jest; tsd uses baseUrl/paths
- Run locally: `pnpm test && pnpm test:types`

Tips:

- Cover both normal and edge/error cases
- Keep helpers small and pure for easy unit testing

## Docs (Next.js)

- Location: `docs/` (Next.js 14, shadcn UI)
- Workspace dependency: uses local `is-kit` (see `docs/package.json`)
- Path mapping for examples: `docs/tsconfig.json` maps `is-kit` â†’ `../dist`
- Transpile local package: `docs/next.config.mjs` `transpilePackages: ['is-kit']`

Useful commands:

```sh
pnpm -C docs dev
pnpm -C docs build && pnpm -C docs start
pnpm -C docs lint
```

## Contributing Flow

1. Implement in `src/**` with small, focused changes
2. Add/adjust tests in `tests/**` and/or `tests-d/**` as needed
3. Ensure `pnpm lint`, `pnpm build`, `pnpm test`, and `pnpm test:types` all pass
4. Follow Conventional Commits (`feat:`, `fix:`, `refactor:`, `docs:`, `test:`, `chore:`)
5. Open a PR with a brief rationale (screenshots for docs changes help)

## Release & Publish

- Versioning: bump via `pnpm version` (e.g., `pnpm version minor`)
- Build: `pnpm build` (bundles ESM, CJS, and types to `dist/`)

JSR (primary):

- Config: `jsr.json` (`name: @nyaomaru/is-kit`, exports `./src/index.ts`)
- Publish TypeScript source for best Deno/JSR integration
- Commands:
  - `npx jsr login` (once)
  - `npx jsr publish`

npm (optional):

- Package name: `is-kit`
- Ensure `main/module/exports/types/files` are correct (already configured)
- Commands:
  - `pnpm publish` (unscoped; `--access public` not required)

## Troubleshooting

- ESLint warns about ESM config: harmless; we use flat ESM config
- Docs not picking up local changes: ensure `docs/next.config.mjs` `transpilePackages: ['is-kit']` and `docs/tsconfig.json` path maps to `../dist`; run `pnpm build` before docs dev if needed
- Type tests fail on path alias: verify `tests-d/tsconfig.json` has `baseUrl: ".."` and `paths: { "@/*": ["src/*"] }`

Happy hacking! ðŸ› âœ¨
